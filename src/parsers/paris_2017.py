"""
Classes for parsing ASCII files from Paris et al. (2017) - SDSS DR12Q.
"""
from pathlib import Path
from .parser import SDSSParser

class Paris2017Parser(SDSSParser):
    """
    Parser for dr12q.dat file from Paris et al. (2017).
    """
    _field_specs: dict[str, tuple] = {
        'SDSS': (0, 18, str),
        'SDSSo': (19, 37, str),
        'RAdeg': (38, 48, float),
        'DEdeg': (49, 59, float),
        'THINGID': (60, 70, int),
        'Plate': (71, 75, int),
        'MJD': (76, 81, int),
        'Fiber': (82, 86, int),
        'z.v': (87, 95, float),
        'z.b': (96, 105, float),
        'e_z.b': (106, 118, float),
        'f_z.b': (119, 122, int),
        'z.PCA': (123, 132, float),
        'e_z.PCA': (133, 142, float),
        'qCont': (143, 153, float),
        'zCIV': (154, 161, float),
        'zCIII': (162, 169, float),
        'zMgII': (170, 177, float),
        'Morph': (178, 180, int),
        'Btarg1': (181, 195, int),
        'Atarg1': (196, 215, int),
        'Atarg2': (216, 233, int),
        'eBtarg0': (234, 247, int),
        'NspBOSS': (248, 250, int),
        'PlateDup': (250, 442, str),  # 32 x I6 array - keep as string
        'MJDDup': (442, 666, str),    # 32 x I7 array - keep as string
        'FiberDup': (666, 858, str),  # 32 x I6 array - keep as string
        'f7': (859, 860, int),
        'Plate7': (861, 866, int),
        'MJD7': (867, 873, int),
        'Fiber7': (874, 878, int),
        'US': (879, 880, int),
        'alphanu': (881, 890, float),
        'SNRSpec': (891, 900, float),
        'SNRDup': (900, 1220, str),   # 32 x F10.4 array - keep as string
        'SNR1700': (1221, 1230, float),
        'SNR3000': (1231, 1240, float),
        'SNR5150': (1241, 1250, float),
        'FW(CIV)': (1251, 1261, float),
        'HW(CIV)b': (1262, 1272, float),
        'HW(CIV)r': (1273, 1283, float),
        'A(CIV)': (1284, 1293, float),
        'W(CIV)': (1294, 1308, float),
        'e_W(CIV)': (1308, 1321, float),
        'FW(CIII)': (1322, 1332, float),
        'HW(CIII)b': (1333, 1343, float),
        'HW(CIII)r': (1344, 1354, float),
        'A(CIII)': (1355, 1364, float),
        'W(CIII)': (1365, 1378, float),
        'e_W(CIII)': (1379, 1392, float),
        'FW(MgII)': (1393, 1403, float),
        'HW(MgII)b': (1404, 1414, float),
        'HW(MgII)r': (1415, 1425, float),
        'A(MgII)': (1426, 1436, float),
        'W(MgII)': (1437, 1450, float),
        'e_W(MgII)': (1451, 1464, float),
        'BAL-VI': (1465, 1466, int),
        'BI(CIVt)': (1467, 1477, float),
        'e_BI(CIVt)': (1478, 1488, float),
        'AI(CIVt)': (1489, 1499, float),
        'e_AI(CIVt)': (1500, 1510, float),
        'Chi2CIVt': (1511, 1521, float),
        'N2t': (1522, 1524, int),
        'Vmin2t': (1525, 1535, float),
        'Vmax2t': (1536, 1546, float),
        'N.45t': (1547, 1550, int),
        'Vmin.45t': (1551, 1561, float),
        'Vmax.45t': (1562, 1572, float),
        'W(SiIVt)': (1573, 1583, float),
        'W(CIVt)': (1584, 1594, float),
        'W(AlIIIt)': (1595, 1605, float),
        'RUN': (1606, 1610, int),
        'Ph-MJD': (1611, 1616, int),
        'Rerun': (1617, 1620, str),
        'Colcam': (1621, 1622, int),
        'Field': (1623, 1626, int),
        'objID': (1627, 1646, str),
        'Fu': (1647, 1659, float),
        'Fg': (1660, 1672, float),
        'Fr': (1673, 1685, float),
        'Fi': (1686, 1698, float),
        'Fz': (1699, 1711, float),
        'IVFu': (1712, 1722, float),
        'IVFg': (1723, 1733, float),
        'IVFr': (1734, 1744, float),
        'IVFi': (1745, 1755, float),
        'IVFz': (1756, 1766, float),
        'umag': (1767, 1779, float),
        'gmag': (1780, 1792, float),
        'rmag': (1793, 1805, float),
        'imag': (1806, 1818, float),
        'zmag': (1819, 1831, float),
        'e_umag': (1832, 1844, float),
        'e_gmag': (1845, 1857, float),
        'e_rmag': (1858, 1870, float),
        'e_imag': (1871, 1883, float),
        'e_zmag': (1884, 1896, float),
        'Fut': (1897, 1909, float),
        'Fgt': (1910, 1922, float),
        'Frt': (1923, 1935, float),
        'Fit': (1936, 1948, float),
        'Fzt': (1949, 1961, float),
        'iMAG': (1962, 1975, float),
        'D(g-i)': (1976, 1989, float),
        'Extu': (1990, 1998, float),
        'Extg': (1999, 2007, float),
        'Extr': (2008, 2016, float),
        'Exti': (2017, 2025, float),
        'Extz': (2026, 2034, float),
        'ExtuR': (2035, 2043, float),
        'ExtgR': (2044, 2052, float),
        'ExtrR': (2053, 2061, float),
        'ExtiR': (2062, 2070, float),
        'ExtzR': (2071, 2079, float),
        'logNHI': (2080, 2087, float),
        'Varmatch': (2088, 2091, int),
        'Varchi2': (2092, 2099, float),
        'VarA': (2100, 2107, float),
        'Vargamma': (2108, 2116, float),
        'logXct': (2117, 2123, float),
        'SNR(X)': (2124, 2131, float),
        'sepX': (2132, 2139, float),
        'NDetX': (2140, 2146, int),
        'F0.2-12': (2147, 2158, float),
        'e_F0.2-12': (2159, 2170, float),
        'F0.2-2': (2171, 2182, float),
        'e_F0.2-2': (2183, 2194, float),
        'F4.5-12': (2195, 2206, float),
        'e_F4.5-12': (2207, 2218, float),
        'F0.2-12W': (2219, 2230, float),
        'e_F0.2-12W': (2231, 2242, float),
        'L0.2-12': (2243, 2254, float),
        'L0.5-2': (2255, 2266, float),
        'L4.5-12': (2267, 2278, float),
        'L0.2-2W': (2279, 2290, float),
        'f_F4.5-12': (2295, 2297, int),
        'sepXM': (2298, 2304, float),
        'GALEX': (2305, 2306, int),
        'FFUV': (2307, 2316, float),
        'IVFUV': (2317, 2327, float),
        'FNUV': (2328, 2337, float),
        'IVNUV': (2338, 2348, float),
        'Jmag': (2349, 2356, float),
        'e_Jmag': (2357, 2367, float),
        'SNR(J)': (2368, 2378, float),
        'f_Jmag': (2379, 2380, int),
        'Hmag': (2381, 2388, float),
        'e_Hmag': (2389, 2399, float),
        'SNR(H)': (2400, 2410, float),
        'f_Hmag': (2411, 2412, int),
        'Kmag': (2413, 2420, float),
        'e_Kmag': (2421, 2431, float),
        'SNR(K)': (2432, 2442, float),
        'f_Kmag': (2443, 2444, int),
        'Sep2': (2445, 2452, float),
        'W1mag': (2453, 2460, float),
        'e_W1mag': (2461, 2470, float),
        'W1SNR': (2471, 2478, float),
        'W1chi2': (2479, 2486, float),
        'W2mag': (2487, 2494, float),
        'e_W2mag': (2495, 2504, float),
        'W2SNR': (2505, 2513, float),
        'W2chi2': (2514, 2521, float),
        'W3mag': (2522, 2529, float),
        'e_W3mag': (2530, 2539, float),
        'W3SNR': (2540, 2548, float),
        'W3chi2': (2549, 2557, float),
        'W4mag': (2558, 2565, float),
        'e_W4mag': (2566, 2575, float),
        'W4SNR': (2576, 2583, float),
        'W4chi2': (2584, 2587, float),
        'CCflags': (2588, 2592, str),
        'PHflag': (2593, 2597, str),
        'sepW': (2598, 2604, float),
        'UKIDSS': (2605, 2606, int),
        'FY': (2607, 2619, float),
        'e_FY': (2620, 2632, float),
        'FJ': (2633, 2645, float),
        'e_FJ': (2646, 2658, float),
        'FH': (2659, 2671, float),
        'e_FH': (2672, 2684, float),
        'FK': (2685, 2697, float),
        'e_FK': (2698, 2710, float),
        'FIRST': (2711, 2713, int),
        'F1p': (2714, 2724, float),
        'SNR(1)': (2725, 2735, float),
        'sep1': (2736, 2742, float),
    }

    @classmethod
    def path_to_data(cls) -> Path:
        from scripts.paris_2017.download_data import PATH_TO_DATA
        return PATH_TO_DATA

class Paris2017BALParser(SDSSParser):
    """
    Parser for dr12qbal.dat file from Paris et al. (2017).
    """
    _field_specs: dict[str, tuple] = {
        'SDSS': (0, 18, str),
        'SDSSo': (19, 37, str),
        'RAdeg': (38, 48, float),
        'DEdeg': (49, 59, float),
        'THINGID': (60, 70, int),
        'Plate': (71, 75, int),
        'MJD': (76, 81, int),
        'Fiber': (82, 86, int),
        'z.v': (87, 95, float),
        'z.b': (96, 105, float),
        'e_z.b': (106, 116, float),
        'f_z.b': (117, 120, int),
        'z.PCA': (121, 130, float),
        'e_z.PCA': (131, 140, float),
        'Morph': (141, 143, int),
        'Btarg1': (144, 158, int),
        'Atarg1': (159, 178, int),
        'Atarg2': (179, 196, int),
        'eBtarg0': (197, 210, int),
        'Fu': (211, 222, float),
        'Fg': (223, 234, float),
        'Fr': (235, 246, float),
        'Fi': (247, 258, float),
        'Fz': (259, 270, float),
        'IVFu': (271, 281, float),
        'IVFg': (282, 292, float),
        'IVFr': (293, 303, float),
        'IVFi': (304, 314, float),
        'IVFz': (315, 325, float),
        'umag': (326, 335, float),
        'gmag': (336, 345, float),
        'rmag': (346, 355, float),
        'imag': (356, 365, float),
        'zmag': (366, 375, float),
        'e_umag': (376, 386, float),
        'e_gmag': (387, 397, float),
        'e_rmag': (398, 408, float),
        'e_imag': (409, 419, float),
        'e_zmag': (420, 430, float),
        'Extu': (431, 439, float),
        'Extg': (440, 448, float),
        'Extr': (449, 457, float),
        'Exti': (458, 466, float),
        'Extz': (467, 475, float),
        'SNRspec': (476, 485, float),
        'SNR1700': (486, 496, float),
        'SNR3000': (497, 506, float),
        'BI(CIVt)': (507, 517, float),
        'e_BI(CIVt)': (518, 528, float),
        'N2t': (529, 531, int),
        'Vmin2t1': (532, 542, float),
        'Vmin2t2': (543, 553, float),
        'Vmin2t3': (554, 564, float),
        'Vmin2t4': (565, 575, float),
        'Vmin2t5': (576, 586, float),
        'Vmax2t1': (587, 597, float),
        'Vmax2t2': (598, 608, float),
        'Vmax2t3': (609, 619, float),
        'Vmax2t4': (620, 630, float),
        'Vmax2t5': (631, 641, float),
        'posmin2t1': (642, 652, float),
        'posmin2t2': (653, 663, float),
        'posmin2t3': (664, 674, float),
        'posmin2t4': (675, 685, float),
        'posmin2t5': (686, 696, float),
        'Fmin2t1': (697, 707, float),
        'Fmin2t2': (708, 718, float),
        'Fmin2t3': (719, 729, float),
        'Fmin2t4': (730, 740, float),
        'Fmin2t5': (741, 751, float),
        'AI(CIVt)': (752, 762, float),
        'e_AI(CIVt)': (763, 773, float),
        'N.45t': (774, 777, int),
        'Vmin.45t1': (777, 788, float),
        'Vmin.45t2': (788, 799, float),
        'Vmin.45t3': (799, 810, float),
        'Vmin.45t4': (810, 821, float),
        'Vmin.45t5': (821, 832, float),
        'Vmin.45t6': (832, 843, float),
        'Vmin.45t7': (843, 854, float),
        'Vmin.45t8': (854, 865, float),
        'Vmin.45t9': (865, 876, float),
        'Vmin.45t10': (876, 887, float),
        'Vmin.45t11': (887, 898, float),
        'Vmin.45t12': (898, 909, float),
        'Vmin.45t13': (909, 920, float),
        'Vmin.45t14': (920, 931, float),
        'Vmin.45t15': (931, 942, float),
        'Vmin.45t16': (942, 953, float),
        'Vmin.45t17': (953, 964, float),
        'Vmax.45t1': (964, 975, float),
        'Vmax.45t2': (975, 986, float),
        'Vmax.45t3': (986, 997, float),
        'Vmax.45t4': (997, 1008, float),
        'Vmax.45t5': (1008, 1019, float),
        'Vmax.45t6': (1019, 1030, float),
        'Vmax.45t7': (1030, 1041, float),
        'Vmax.45t8': (1041, 1052, float),
        'Vmax.45t9': (1052, 1063, float),
        'Vmax.45t10': (1063, 1074, float),
        'Vmax.45t11': (1074, 1085, float),
        'Vmax.45t12': (1085, 1096, float),
        'Vmax.45t13': (1096, 1107, float),
        'Vmax.45t14': (1107, 1118, float),
        'Vmax.45t15': (1118, 1129, float),
        'Vmax.45t16': (1129, 1140, float),
        'Vmax.45t17': (1140, 1151, float),
        'posmin.45t1': (1151, 1162, float),
        'posmin.45t2': (1162, 1173, float),
        'posmin.45t3': (1173, 1184, float),
        'posmin.45t4': (1184, 1195, float),
        'posmin.45t5': (1195, 1206, float),
        'posmin.45t6': (1206, 1217, float),
        'posmin.45t7': (1217, 1228, float),
        'posmin.45t8': (1228, 1239, float),
        'posmin.45t9': (1239, 1250, float),
        'posmin.45t10': (1250, 1261, float),
        'posmin.45t11': (1261, 1272, float),
        'posmin.45t12': (1272, 1283, float),
        'posmin.45t13': (1283, 1294, float),
        'posmin.45t14': (1294, 1305, float),
        'posmin.45t15': (1305, 1316, float),
        'posmin.45t16': (1316, 1327, float),
        'posmin.45t17': (1327, 1338, float),
        'Fmin.45t1': (1338, 1349, float),
        'Fmin.45t2': (1349, 1360, float),
        'Fmin.45t3': (1360, 1371, float),
        'Fmin.45t4': (1371, 1382, float),
        'Fmin.45t5': (1382, 1393, float),
        'Fmin.45t6': (1393, 1404, float),
        'Fmin.45t7': (1404, 1415, float),
        'Fmin.45t8': (1415, 1426, float),
        'Fmin.45t9': (1426, 1437, float),
        'Fmin.45t10': (1437, 1448, float),
        'Fmin.45t11': (1448, 1459, float),
        'Fmin.45t12': (1459, 1470, float),
        'Fmin.45t13': (1470, 1481, float),
        'Fmin.45t14': (1481, 1492, float),
        'Fmin.45t15': (1492, 1503, float),
        'Fmin.45t16': (1503, 1514, float),
        'Fmin.45t17': (1514, 1525, float),
    }

    @classmethod
    def path_to_data(cls) -> Path:
        from scripts.paris_2017.download_data import PATH_TO_DATA_BAL
        return PATH_TO_DATA_BAL